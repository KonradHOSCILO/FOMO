<article
    class="task-card {% if task.is_completed %}is-completed{% endif %}"
    draggable="true"
    data-task-id="{{ task.id }}"
    data-group-id="{{ task.group_id|default_if_none:'' }}"
    style="--task-accent: {{ task.accent_color }};"
>
    <header class="task-card__head">
        <div class="task-card__icon">{{ task.icon|default:"ðŸ“Œ" }}</div>
        <div class="task-card__labels">
            <span class="priority-pill priority-{{ task.priority }}">{{ task.get_priority_display }}</span>
            {% if task.repeat_frequency != task.RepeatFrequency.NONE %}
                <span class="badge soft">â†» {{ task.get_repeat_frequency_display }}</span>
            {% endif %}
        </div>
        <form method="post" action="{% url 'toggle_task' task.id %}{% if query_string %}?{{ query_string }}{% endif %}" class="toggle-form">
            {% csrf_token %}
            <button type="submit" class="toggle-chip" title="Oznacz jako wykonane">
                {% if task.is_completed %}âœ”{% else %}â—‹{% endif %}
            </button>
        </form>
    </header>

    <div class="task-card__body">
        <div class="task-card__title">{{ task.title }}</div>
        {% if task.description %}
            <p class="task-card__description">{{ task.description }}</p>
        {% endif %}

        <div class="task-card__meta">
            <span>Dodano: {{ task.created_at|date:"d.m.Y H:i" }}</span>
            {% if task.due_date %}
                <span>Termin: {{ task.due_date|date:"d.m.Y H:i" }}</span>
            {% endif %}
            {% if task.group %}
                <span class="group-chip" style="--chip-color: {{ task.group.color }}">{{ task.group.name }}</span>
            {% endif %}
        </div>
    </div>

    <footer class="task-card__footer">
        <div class="task-card__move">
            <form method="post" action="{% url 'move_task' task.id %}{% if query_string %}?{{ query_string }}{% endif %}">
                {% csrf_token %}
                <input type="hidden" name="position" value="0">
                <select name="group_id" class="group-select" onchange="this.form.submit()">
                    <option value="" {% if not task.group %}selected{% endif %}>Inbox</option>
                    {% for group in groups %}
                        <option value="{{ group.id }}" {% if task.group_id == group.id %}selected{% endif %}>
                            {{ group.name }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <div class="task-card__actions">
            <a class="icon-button ghost" href="{% url 'edit_task' task.id %}{% if query_string %}?{{ query_string }}{% endif %}" title="Edytuj">
                âœŽ
            </a>
            <form method="post" action="{% url 'delete_task' task.id %}{% if query_string %}?{{ query_string }}{% endif %}">
                {% csrf_token %}
                <button type="submit" class="icon-button danger" title="UsuÅ„">âœ•</button>
            </form>
        </div>
    </footer>
</article>

